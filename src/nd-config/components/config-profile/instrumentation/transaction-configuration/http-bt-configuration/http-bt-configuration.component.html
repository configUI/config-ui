<div class="ui-g">
    <div class="ui-g-6" style="margin-bottom:5px; font-weight: bold">
        HTTP Business Transaction Configuration
    </div>

    <div class="ui-g-12" style="background: #ededf0">
        <div class="ui-g-3">
            <p-radioButton name="BusinessTransaction" [disabled]="saveDisable" value="global" label="URI without query parameters" (click)="setSelectedValueOfBT('global')" [(ngModel)]="selectedQueryPattern"></p-radioButton>
        </div>
        <div class="ui-g-9">
            <p-radioButton name="BusinessTransaction" [disabled]="saveDisable" value="pattern" label="Pattern" (click)="setSelectedValueOfBT('pattern')" [(ngModel)]="selectedQueryPattern"></p-radioButton>
        </div>
    </div>
</div>
<div class="ui-g" *ngIf="selectedQueryPattern == 'global'" style="margin-bottom:10px; border: ridge;">
    <form (ngSubmit)="saveBusinessTransaction()" #groupForm="ngForm" ngNativeValidate>
        <div class="ui-g-12 header-font-size">
            <div class="ui-g-6"> Select part of URI used in transaction name </div>
            <div class="ui-g-6" style="text-align:right">
                <button type="button" pButton icon="fa-refresh" [disabled]="saveDisable" (click)="resetBusinessTransaction()" label="Reset"></button>
                <button type="submit" pButton icon="fa-check" [disabled]="saveDisable" label="Save"></button>
            </div>
        </div>
        <div class="ui-g-12 padding-left-css">
            <p-radioButton name="partOfURI" label="Complete" value="complete" [(ngModel)]="segmentURI"></p-radioButton>
        </div>

        <div class="ui-g-12 padding-left-css">
            <div class="ui-g-2 segment-type-css">
                <p-radioButton name="partOfURI" label="Segment of URI" value="segmentOfURI" [(ngModel)]="segmentURI"></p-radioButton>
            </div>
            <div class="ui-g-2">
                <p-dropdown name="segmentType" [disabled]="!(segmentURI == 'segmentOfURI')" [style]="{'width':'70%'}" [options]="segmentList" [(ngModel)]="globalBtDetail.segmentType"></p-dropdown>
            </div>
            <div class="ui-g-2" style="margin-top:4px">
                Segment(s) of URI in transaction</div>
            <div class="ui-g-2"> <input name="segmentValue" style="text-align:right" [disabled]="!(segmentURI == 'segmentOfURI')" *ngIf="globalBtDetail.segmentType == 'first'  || globalBtDetail.segmentType == 'last'" type="text" style="width: 50%" pInputText [(ngModel)]="globalBtDetail.segmentValue"
                    title="Please enter Segment(s) of URI in valid format. &#013;Rule-1: Numeric characters alone are accepted.  &#013;For example 2 or 5" required pattern="[1-9]+[0-9]*" ngModel />
                <input name="segmentValue" style="text-align:right" [disabled]="!(segmentURI == 'segmentOfURI')" *ngIf="globalBtDetail.segmentType == 'segNo'" type="text" style="width: 50%" pInputText [(ngModel)]="globalBtDetail.segmentValue" title="Please enter Segment(s) of URI in valid format. &#013;Rule-1: Numeric characters alone are accepted.  &#013;Rule-2: Numeric characters separated by comma(,) are accepted.  &#013;For example 2 or 2,4"
                    required pattern="[1-9]+(,[1-9]+)*" ngModel />
            </div>
        </div>

        <div class="ui-g-12 header-font-size">
            <label>Transaction threshold</label>
        </div>

        <div class="ui-g-12 padding-left-css">
            <div class="ui-g-1"><label>Slow</label></div>
            <div class="ui-g-10">
                <input name="slowTransaction" #slow (input)="checkSlow(slow, vslow)" style="text-align:right; width:70px " type="number" min=1 pInputText [(ngModel)]="globalBtDetail.slowTransaction" required/>(ms)
            </div>
        </div>

        <div class="ui-g-12 padding-left-css">
            <div class="ui-g-1"> <label>Very slow</label> </div>
            <div class="ui-g-10">
                <input name="verySlowTransaction" #vslow (input)="checkVSlow(slow, vslow)" style="text-align:right ; width:70px" type="number" min=1 pInputText [(ngModel)]="globalBtDetail.verySlowTransaction" required />(ms)
            </div>
        </div>
        <div class="ui-g-12 header-font-size" *ngIf="agentType == 'NodeJS'">
            <label>Dynamic threshold(Optional)</label>
        </div>

        <div class="ui-g-12 padding-left-css" *ngIf="agentType == 'NodeJS'">
            <div class="ui-g-1"><label>Slow</label></div>
            <div class="ui-g-10">
                <input name="slowThreshold" #slowthresh  style="text-align:right; width:70px " type="number" min=0 pInputText [(ngModel)]="globalBtDetail.slowDynamicThreshold" /> %
            </div>
        </div>

        <div class="ui-g-12 padding-left-css" *ngIf="agentType == 'NodeJS'">
            <div class="ui-g-1"> <label>Very slow</label> </div>
            <div class="ui-g-10">
                <input name="verySlowThreshold" #vslowthresh style="text-align:right ; width:70px" type="number" min=0 pInputText [(ngModel)]="globalBtDetail.verySlowDynamicThreshold" /> %
            </div>
        </div>
        <div class="ui-g-12 header-font-size">
            <p-checkbox name="dynamicReqType" label="Choose dynamic request type" [(ngModel)]="globalBtDetail.dynamicReqType" binary="true"></p-checkbox>
        </div>

        <div class="ui-g-12 padding-left-css">
            <div class="ui-g-2">
                <p-radioButton [disabled]="!globalBtDetail.dynamicReqType" name="dynamicReqValue1" value="requestParam" label="Query parameter" [(ngModel)]="globalBtDetail.dynamicReqValue"></p-radioButton>
            </div>
            <div class="ui-g-10 ">
                <input name="requestParam" type="text" [disabled]="(!(globalBtDetail.dynamicReqValue == 'requestParam') || !globalBtDetail.dynamicReqType) " size="32" pInputText [(ngModel)]="globalBtDetail.requestParam" title="Please enter valid parameter value. &#013;Rule 1 :Cannot include whitespaces & Can't start with special characters .&#013;Rule 2 :In between alphanumeric character only these special character accepted (.-_%@$)"
                    (keydown.space)="$event.preventDefault()" pattern="[a-zA-Z0-9]+[a-zA-Z0-9_%@.$-]*$" required />
            </div>
        </div>

        <div class="ui-g-12 padding-left-css">
            <p-radioButton [disabled]="!globalBtDetail.dynamicReqType" name="dynamicReqValue2" value="httpMethod" label="Use HTTP request method(GET/POST/PUT) in transaction names" [(ngModel)]="globalBtDetail.dynamicReqValue"></p-radioButton>
        </div>

        <div class="ui-g-12 padding-left-css">
            <div class="ui-g-2">
                <p-radioButton [disabled]="!globalBtDetail.dynamicReqType" name="dynamicReqValue3" value="requestHeader" label="HTTP header" [(ngModel)]="globalBtDetail.dynamicReqValue"></p-radioButton>
            </div>
            <div class="ui-g-10">
                <input name="requestHeader" type="text" [disabled]="(!(globalBtDetail.dynamicReqValue == 'requestHeader') || !globalBtDetail.dynamicReqType)" size="32" pInputText [(ngModel)]="globalBtDetail.requestHeader " title="Please enter valid header value. &#013;Rule 1 :Cannot include whitespaces & Can't start with special characters .&#013;Rule 2 :In between alphanumeric character only these special character accepted (.-_%@$)"
                    (keydown.space)="$event.preventDefault()" pattern="[a-zA-Z0-9]+[a-zA-Z0-9_%@.$-]*$" required />
            </div>
        </div>
    </form>
</div>
<!--For showing Business Transaction Pattern(s) list -->
<div class="ui-g" *ngIf="selectedQueryPattern == 'pattern'" style="margin-bottom:10px; border: ridge;">
    <p-dataTable class="nde-ui" [value]="businessTransPatternInfo" [(selection)]="selectedPatternData" [rows]="10" [paginator]="businessTransPatternInfo?.length > 10" [pageLinks]="3">
        <p-header [style]="{'height':'25px'}">
            <span style="float: left;">Business transaction pattern list</span>
            <span style="float: right; margin-top:-3px">

                       <button pButton type="button" title="Browse" [disabled]="saveDisable" (click)="openFileManager()" icon="fa-folder-open"></button>
                       <button pButton type="button" title="Add a Business transaction pattern" [disabled]="saveDisable" (click)="openAddPatternDialog()" icon="fa-plus"></button>
                       <button pButton type="button" title="Edit a Business transaction pattern" [disabled]="saveDisable" (click)="editPatternDialog()" icon="fa-pencil" ></button>
                       <button pButton type="button"class="ui-button-danger" title="Delete business transaction pattern(s)" [disabled]="saveDisable" (click)="deletePattern()" icon="fa-trash"></button>
                    </span>
        </p-header>
        <p-column [style]="{'width':'3%'}" selectionMode="multiple"></p-column>
        <p-column class="col-overflow" field="btName" header="Name" [sortable]="true" [style]="{'width':'19%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}"><a [routerLink]="['/tree-main', application['dcId']]">{{application[col.field]}}</a></span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="matchType" header="Match type" [sortable]="true" [style]="{'width':'8%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="urlName" header="URL" [sortable]="true" [style]="{'width':'23%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="include" header="BT included" [sortable]="true" [style]="{'width':'6%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="slowTransaction" header="Slow transaction threshold(ms)" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}" style="float:right">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="verySlowTransaction" header="Very slow transaction threshold(ms)" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}" style="float:right">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column *ngIf="agentType == 'NodeJS'" class="col-overflow" field="slowDynamicThreshold" header="Slow dynamic threshold(%)" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}" style="float:right">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column *ngIf="agentType == 'NodeJS'" class="col-overflow" field="verySlowDynamicThreshold" header="Very slow dynamic threshold(%)" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}" style="float:right">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="paramKeyValue" header="Req param key value" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="reqMethod" header="HTTP method" [sortable]="true" [style]="{'width':'6%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>
        <p-column class="col-overflow" field="headerKeyValue" header="Req header key value" [sortable]="true" [style]="{'width':'9%'}">
            <template let-col let-application="rowData" pTemplate type="body">
        <span title="{{application[col.field]}}">{{application[col.field]}}</span>
      </template>
        </p-column>

    </p-dataTable>
</div>

<!--Dialog for ADD and Edit Pattern-->
<p-dialog class="profile-dialog" header="{{isNewApp ? 'Add business transaction pattern' : 'Edit business transaction pattern'}}" *ngIf="addEditPatternDialog" [(visible)]="addEditPatternDialog" modal="modal" width="950" responsive="true" [resizable]="false">
    <form (ngSubmit)="saveADDEditBTPatternTrans()" #groupForm="ngForm" ngNativeValidate>
        <div class="ui-g">
            <div class="pattern-dialog-border">
                <div class="ui-g-12">
                    <div class="ui-g-3">
                        <label>Business transaction name</label>
                    </div>
                    <div class="ui-g-4">
                        <input name="btName" type="text" size="40" pInputText pattern="^[a-zA-Z0-9_#@./&-]{0,99}$" [(ngModel)]="businessTransPatternDetail.btName" autofocus required ngModel/>
                    </div>
                    <div class="ui-g-5">
                        <p-checkbox name="include" label="Include this business transaction" [(ngModel)]="chkInclude" binary="false"></p-checkbox>
                    </div>
                </div>

                <div class="ui-g-12">
                    <div class="ui-g-3">
                        <label>URL pattern</label>
                    </div>
                    <div class="ui-g-4">
                        <input name="urlName" type="text" size="40" pInputText pattern="[a-zA-Z0-9_\/.|@?*%#$&=-]{0,249}$" title="Please enter valid url. &#013;Rule1 : Cannot include whitespaces. &#013;Rule2 : Can include alphanumerics ,@,#,$,%,&,*,-,=,?,.,|,/ and underscore. &#013;Rule3 :Maximum of 250 characters are allowed."
                            [(ngModel)]="businessTransPatternDetail.urlName" required ngModel />
                    </div>
                    <div class="ui-g-5">
                        <input name="dropdown" type="text" size="10" class='hidden-validator' pInputText [(ngModel)]="businessTransPatternDetail.matchType" required ngModel/>
                        <p-dropdown name="matchType" [style]="{'width':'100px'}" [options]="matchModeList" placeholder="Select mode" [(ngModel)]="businessTransPatternDetail.matchType" required ngModel></p-dropdown>
                    </div>
                </div>
            </div>

            <div class="ui-g-12 pattern-dialog-border">
                <div class="ui-g-3 label">
                    <label>Transaction threshold (ms)</label>
                </div>
                <div class="ui-g-1 label">
                    <label>Slow</label>
                </div>
                <div class="ui-g-3">
                    <input name="slowTransaction" style="text-align:right" type="text" size="10" pInputText [(ngModel)]="businessTransPatternDetail.slowTransaction" required ngModel />(ms)
                </div>
                <div class="ui-g-1 label">
                    <label>Very Slow</label>
                </div>
                <div class="ui-g-3">
                    <input name="verySlowTransaction" type="text" style="text-align:right" size="10" pInputText [(ngModel)]="businessTransPatternDetail.verySlowTransaction" required ngModel />(ms)
                </div>
            </div>

            <div class="ui-g-12 pattern-dialog-border" *ngIf="agentType == 'NodeJS'">
                <div class="ui-g-3 label">
                    <label>Dynamic threshold (%)</label>
                </div>
                <div class="ui-g-1 label">
                    <label>Slow</label>
                </div>
                <div class="ui-g-3">
                    <input name="slowDynamic" style="text-align:right" type="text" size="10" pInputText [(ngModel)]="businessTransPatternDetail.slowDynamicThreshold" ngModel /> %
                </div>
                <div class="ui-g-1 label">
                    <label>Very Slow</label>
                </div>
                <div class="ui-g-3">
                    <input name="verySlowDynamic" type="text" style="text-align:right" size="10" pInputText [(ngModel)]="businessTransPatternDetail.verySlowDynamicThreshold" ngModel /> %
                </div>
            </div>

            <div class="pattern-dialog-border">
                <div class="ui-g-12">
                    <p-checkbox name="dynamicPartReq" label="Dynamic part of request" [(ngModel)]="businessTransPatternDetail.dynamicPartReq" binary="false"></p-checkbox>
                </div>
                <div class="ui-g-12" style="padding-left: 27px">
                    <p-checkbox name="reqParamKey" label="Request parameters" [disabled]="!businessTransPatternDetail.dynamicPartReq" [(ngModel)]="reqParamKeyCheck" binary="false"></p-checkbox>
                </div>
                <div class="ui-g-12" style="padding-left: 27px">
                    <div class="ui-g-6">
                        <p-dataTable class="nde-ui" [rows]="2" [value]="reqParamInfo" [paginator]="5" [(selection)]="selectedReqParam" *ngIf="reqParamKeyCheck" [pageLinks]="2">
                            <p-header>
                                <span style="float: left;">  Request parameters list  </span>
                                <span style="float: right; margin-top:-3px">
                       <button pButton type="button" title="Add a request parameter" (click)="openReqKeyValDialog()"  icon="fa-plus"></button>
                        <button pButton type="button" title="Edit a request parameter" (click)="openEditReqParamDialog()"  icon="fa-pencil" ></button>
                       <button pButton type="button"class="ui-button-danger" title="Delete request parameters" (click)="deleteReqParam()" icon="fa-trash"></button>
                    </span>
                            </p-header>
                            <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column>
                            <p-column class="col-overflow" field="key" header="Key" [sortable]="true">
                                <template let-col let-application="rowData">
                  <span title="{{application[col.field]}}">{{application[col.field]}}</span>
                </template>
                            </p-column>
                            <p-column class="col-overflow" field="value" header="Value" [sortable]="true">
                                <template let-col let-application="rowData">
                  <span title="{{application[col.field]}}">{{application[col.field]}}</span>
                </template>
                            </p-column>
                        </p-dataTable>
                    </div>
                </div>

                <div class="ui-g-12">
                    <div class="ui-g-6" style="padding-left: 20px">
                        <div class="ui-g-5">
                            <label>Request header key</label>
                        </div>
                        <div class="ui-g-7">
                            <input name="reqHeaderKey" disabled="{{!businessTransPatternDetail.dynamicPartReq}}" type="text" size="25" pInputText [(ngModel)]="businessTransPatternDetail.reqHeaderKey" title="Please enter valid key value. &#013;Rule 1:Cannot include whitespaces & special characters . &#013;Rule 2: First character can't be numeric"
                                pattern="[a-zA-Z_]+[a-zA-Z0-9]*$" (keydown.space)="$event.preventDefault()" />
                        </div>
                    </div>
                    <div class="ui-g-6">
                        <div class="ui-g-2">
                            <label>Value</label>
                        </div>
                        <div class="ui-g-8">
                            <input name="reqHeaderValue" [disabled]="((!businessTransPatternDetail.dynamicPartReq) || (!this.businessTransPatternDetail.reqHeaderKey))" type="text" size="25" pInputText [(ngModel)]="businessTransPatternDetail.reqHeaderValue" title="Please enter valid value. &#013;Rule1 : Cannot include whitespaces. &#013;Rule2 : Cannot include special characters except /,@,|,-,*,? and underscore"
                                pattern="[a-zA-Z0-9_\/.|@?*-]+$" (keydown.space)="$event.preventDefault()" />
                        </div>
                    </div>
                </div>
                <div class="ui-g-12">
                    <div class="ui-g-6" style="padding-left: 20px">
                        <div class="ui-g-5">
                            <label>Method type</label>
                        </div>
                        <div class="ui-g-7">
                            <p-dropdown name="reqMethod" [disabled]="!businessTransPatternDetail.dynamicPartReq" [style]="{'width':'72.5%'}" [options]="methodTypeList" placeholder="--Select method--" [(ngModel)]="businessTransPatternDetail.reqMethod" appendTo="body"></p-dropdown>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <footer>
            <div class="ui-dialog-buttonpane ui-widget-content">
                <button type="submit" pButton icon="fa-check" label="Save"></button>
                <button type="button" pButton icon="fa-close" (click)="closeDialog()" label="Cancel"></button>
            </div>
        </footer>
    </form>
</p-dialog>
<!--Dialog to open file explorer dialog -->
<p-dialog class="profile-dialog browseTopCss headerCss" header="File Manager" *ngIf="openFileExplorerDialog" [(visible)]="openFileExplorerDialog" modal="modal" width="650" responsive="true" [resizable]="false">

    <!-- This will look for this component in the ProductUI at this path -
     ..\ProductUI\gui\src\app\modules\file-explorer\components\config-nd-file-explorer\-->

    <!-- <app-config-nd-file-explorer></app-config-nd-file-explorer> -->
</p-dialog>

<!-- Dialog to open request parameter key and value -->
<p-dialog class="profile-dialog" header="{{isNewParam ? 'Add details' : 'Edit details'}}" *ngIf="openReqKeyVal" [(visible)]="openReqKeyVal" modal="modal" width="350" responsive="true" [resizable]="false">
    <form (ngSubmit)="saveReqParam()" #groupForm="ngForm" ngNativeValidate>
        <div class="ui-g-12">
            <div class="ui-g-3">
                <label>Key</label>
            </div>
            <div class="ui-g-6">
                <input name="reqParamKey" type="text" pInputText [(ngModel)]="reqParamDetail.key" title="Please enter valid key value. &#013;Rule 1:Cannot include whitespaces & special characters . &#013;Rule 2: First character can't be numeric" pattern="[a-zA-Z_]+[a-zA-Z0-9]*$"
                    (keydown.space)="$event.preventDefault()" required ngModel/>
            </div>
        </div>
        <div class="ui-g-12">
            <div class="ui-g-3">
                <label>Value</label>
            </div>
            <div class="ui-g-6">
                <input name="reqParamValue" type="text" pInputText [(ngModel)]="reqParamDetail.value" title="Please enter valid value. &#013;Rule1 : Cannot include whitespaces. &#013;Rule2 : Cannot include special characters except /,@,|,-,*,? and underscore" pattern="[a-zA-Z0-9_\/.|@?*-]+$"
                    (keydown.space)="$event.preventDefault()" />
            </div>
        </div>
        <footer>
            <div class="ui-dialog-buttonpane ui-widget-content">
                <button type="submit" pButton icon="fa-check" label="Save"></button>
                <button type="button" pButton icon="fa-close" (click)="closeReqKeyValDialog()" label="Cancel"></button>
            </div>
        </footer>
    </form>
</p-dialog>